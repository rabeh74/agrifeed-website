{% extends 'store/base.html' %}

{% block title %}{{ customer.full_name }} - Agree Feed{% endblock %}

{% block content %}
<div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
    <a href="{% url 'store:customer_list' %}" class="btn btn-secondary">
        <span>â†</span> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡
    </a>
    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
        <a href="{% url 'store:customer_edit' customer.id %}" class="btn">
            <span>âœï¸</span> ØªØ¹Ø¯ÙŠÙ„
        </a>
        <a href="{% url 'store:customer_delete' customer.id %}" class="btn btn-danger">
            <span>ğŸ—‘ï¸</span> Ø­Ø°Ù
        </a>
    </div>
</div>

<div class="grid" style="grid-template-columns: 1fr 2fr; gap: 1.5rem; align-items: start;">
    <!-- Customer Info Card -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title" style="display: flex; align-items: center; gap: 0.5rem;">
                <span>ğŸ‘¤</span> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
            </h2>
        </div>

        <div>
            <div class="info-row">
                <span class="info-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</span>
                <span class="info-value"><strong>{{ customer.full_name }}</strong></span>
            </div>

            {% if customer.phone_number %}
            <div class="info-row">
                <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
                <span class="info-value" style="direction: ltr; text-align: left;">{{ customer.phone_number }}</span>
            </div>
            {% endif %}

            <div class="info-row">
                <span class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</span>
                <span class="info-value">{{ customer.created_at|date:"Y/m/d - H:i" }}</span>
            </div>

            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid var(--gray-100);">
                <h4 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--text-secondary); display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ“Š</span> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                </h4>
                <div class="info-row">
                    <span class="info-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</span>
                    <span class="info-value" style="font-weight: 600;">{{ total_orders }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†:</span>
                    <span class="info-value" style="color: {% if total_debt > 0 %}var(--danger-color){% else %}var(--success-color){% endif %}; font-weight: 700; font-size: 1.1rem;">
                        {{ total_debt }} Ø¬.Ù…
                        {% if total_debt == 0 %}
                            <span style="font-size: 0.9rem;">âœ“</span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Order History Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title" style="font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem;">
                <span>ğŸ“‹</span> Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            </h3>
        </div>

        {% if orders %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        <th>Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                        <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td><strong style="color: var(--primary-color);">#{{ order.id }}</strong></td>
                        <td>
                            <span class="badge badge-{{ order.status }}">
                                {% if order.status == 'completed' %}
                                    âœ“ Ù…ÙƒØªÙ…Ù„
                                {% else %}
                                    âœ• Ù…Ù„ØºÙŠ
                                {% endif %}
                            </span>
                        </td>
                        <td><span class="price">{{ order.get_total_price }} Ø¬.Ù…</span></td>
                        <td><span class="price" style="color: var(--success-color);">{{ order.paid_amount }} Ø¬.Ù…</span></td>
                        <td>
                            <span class="price" style="color: {% if order.is_fully_paid %}var(--success-color){% else %}var(--danger-color){% endif %}; font-weight: 700;">
                                {{ order.get_remaining_amount }} Ø¬.Ù…
                                {% if order.is_fully_paid %}<span style="font-size: 0.8rem;">âœ“</span>{% endif %}
                            </span>
                        </td>
                        <td>{{ order.created_at|date:"Y/m/d" }}</td>
                        <td>
                            <a href="{% url 'store:order_detail' order.id %}" class="btn btn-sm">
                                <span>ğŸ‘ï¸</span> Ø¹Ø±Ø¶
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ“‹</div>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯</p>
            <a href="{% url 'store:create_order' %}" class="btn btn-success">
                <span>ğŸ›’</span> Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
            </a>
        </div>
        {% endif %}
    </div>
</div>

{% block extra_css %}
<style>
    @media (max-width: 968px) {
        .grid {
            grid-template-columns: 1fr !important;
        }
    }
</style>
{% endblock %}
{% endblock %}

