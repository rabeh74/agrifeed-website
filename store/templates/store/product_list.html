{% extends 'store/base.html' %}

{% block title %}ุงูููุชุฌุงุช - Agree Feed{% endblock %}

{% block content %}
<div class="page-header">
    <h2><span>๐ฆ</span> ูุงุฆูุฉ ุงูููุชุฌุงุช</h2>
    <a href="{% url 'store:add_product' %}" class="btn btn-success">
        <span>โ</span> ุฅุถุงูุฉ ููุชุฌ
    </a>
</div>

<!-- Search and Filter Section -->
<div class="card">
    <form method="get" action="{% url 'store:product_list' %}">
        <div class="grid grid-4">
            <!-- Search Box -->
            <div class="form-group" style="margin-bottom: 0;">
                <label>๐ ุจุญุซ</label>
                <input type="text" name="search" class="form-control" placeholder="ุงุจุญุซ ุนู ููุชุฌ..." value="{{ search_query }}">
            </div>

            <!-- Stock Filter -->
            <div class="form-group" style="margin-bottom: 0;">
                <label>๐ ุญุงูุฉ ุงููุฎุฒูู</label>
                <select name="stock" class="form-control">
                    <option value="all" {% if stock_filter == 'all' %}selected{% endif %}>ุงููู</option>
                    <option value="in_stock" {% if stock_filter == 'in_stock' %}selected{% endif %}>ูุชููุฑ</option>
                    <option value="low_stock" {% if stock_filter == 'low_stock' %}selected{% endif %}>ูุฎุฒูู ููุฎูุถ (โค10)</option>
                    <option value="out_of_stock" {% if stock_filter == 'out_of_stock' %}selected{% endif %}>ุบูุฑ ูุชููุฑ</option>
                </select>
            </div>

            <!-- Sort -->
            <div class="form-group" style="margin-bottom: 0;">
                <label>๐ ุชุฑุชูุจ ุญุณุจ</label>
                <select name="sort" class="form-control">
                    <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>ุงูุฃุญุฏุซ ุฃููุงู</option>
                    <option value="created_at" {% if sort_by == 'created_at' %}selected{% endif %}>ุงูุฃูุฏู ุฃููุงู</option>
                    <option value="name" {% if sort_by == 'name' %}selected{% endif %}>ุงูุงุณู (ุฃ-ู)</option>
                    <option value="-name" {% if sort_by == '-name' %}selected{% endif %}>ุงูุงุณู (ู-ุฃ)</option>
                    <option value="price" {% if sort_by == 'price' %}selected{% endif %}>ุงูุณุนุฑ (ุงูุฃูู)</option>
                    <option value="-price" {% if sort_by == '-price' %}selected{% endif %}>ุงูุณุนุฑ (ุงูุฃุนูู)</option>
                    <option value="stock" {% if sort_by == 'stock' %}selected{% endif %}>ุงููุฎุฒูู (ุงูุฃูู)</option>
                    <option value="-stock" {% if sort_by == '-stock' %}selected{% endif %}>ุงููุฎุฒูู (ุงูุฃูุซุฑ)</option>
                </select>
            </div>

            <!-- Submit Button -->
            <div style="display: flex; align-items: flex-end;">
                <button type="submit" class="btn" style="width: 100%;">
                    <span>๐</span> ุชุทุจูู
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Products Count -->
{% if search_query or stock_filter != 'all' %}
<div class="card" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-right: 4px solid #3b82f6;">
    <p style="margin: 0; color: #1e40af; font-weight: 600;">
        <span>โน๏ธ</span> ุชู ุงูุนุซูุฑ ุนูู {{ products.count }} ููุชุฌ
        {% if search_query %} ูู ูุชุงุฆุฌ ุงูุจุญุซ ุนู "{{ search_query }}"{% endif %}
    </p>
</div>
{% endif %}

{% if products %}
<div class="grid grid-3">
    {% for product in products %}
    <div class="card" style="display: flex; flex-direction: column;">
        <!-- Product Image -->
        {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}"
                 style="width: 100%; height: 220px; object-fit: cover; border-radius: var(--border-radius); margin-bottom: 1.25rem;">
        {% else %}
            <div style="width: 100%; height: 220px; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
                        border-radius: var(--border-radius); margin-bottom: 1.25rem;
                        display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 0.5rem;">
                <span style="font-size: 4rem; opacity: 0.3;">๐ฆ</span>
                <span style="color: #9ca3af; font-size: 0.875rem;">ูุง ุชูุฌุฏ ุตูุฑุฉ</span>
            </div>
        {% endif %}

        <!-- Product Info -->
        <h3 style="margin-bottom: 0.75rem; color: var(--text-primary); font-size: 1.25rem;">{{ product.name }}</h3>
        <p style="color: var(--text-secondary); margin-bottom: 1.25rem; line-height: 1.6; flex-grow: 1;">
            {{ product.description|truncatewords:15 }}
        </p>

        <!-- Product Meta -->
        <div style="border-top: 2px solid var(--gray-100); padding-top: 1.25rem; margin-top: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <span class="price">{{ product.price }} ุฌ.ู</span>
                <span class="badge {% if product.stock > 10 %}badge-completed{% elif product.stock > 0 %}badge-pending{% else %}badge-cancelled{% endif %}">
                    {% if product.stock > 10 %}
                        โ ูุชููุฑ: {{ product.stock }}
                    {% elif product.stock > 0 %}
                        โ ููุฎูุถ: {{ product.stock }}
                    {% else %}
                        โ ุบูุฑ ูุชููุฑ
                    {% endif %}
                </span>
            </div>

            <!-- Created Date -->
            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1rem;">
                <span>๐</span> ุฃุถูู ูู {{ product.created_at|date:"Y/m/d" }}
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 0.75rem;">
                <a href="{% url 'store:edit_product' product.id %}" class="btn btn-sm" style="flex: 1; text-align: center; justify-content: center;">
                    <span>โ๏ธ</span> ุชุนุฏูู
                </a>
                <a href="{% url 'store:delete_product' product.id %}" class="btn btn-danger btn-sm" style="flex: 1; text-align: center; justify-content: center;">
                    <span>๐๏ธ</span> ุญุฐู
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card empty-state">
    <div class="empty-state-icon">๐ฆ</div>
    <h3>ูุง ุชูุฌุฏ ููุชุฌุงุช</h3>
    <p>
        {% if search_query %}
            ูู ูุชู ุงูุนุซูุฑ ุนูู ููุชุฌุงุช ุชุทุงุจู ุจุญุซู ุนู "{{ search_query }}"
        {% else %}
            ูุง ุชูุฌุฏ ููุชุฌุงุช ุญุงููุงู ูู ุงููุธุงู
        {% endif %}
    </p>
    {% if search_query %}
        <a href="{% url 'store:product_list' %}" class="btn">
            <span>โป</span> ุนุฑุถ ุฌููุน ุงูููุชุฌุงุช
        </a>
    {% else %}
        <a href="{% url 'store:add_product' %}" class="btn btn-success">
            <span>โ</span> ุฅุถุงูุฉ ุฃูู ููุชุฌ
        </a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
