{% extends 'store/base.html' %}

{% block title %}ุฅุฏุฎุงูุงุช ุงูููุชุฌุงุช - Agree Feed{% endblock %}

{% block content %}
<div class="page-header">
    <h2>
        <span>๐ฅ</span>
        <span>ุฅุฏุฎุงูุงุช ุงูููุชุฌุงุช</span>
    </h2>
    <a href="{% url 'store:add_product_entry' %}" class="btn btn-success">
        <span>โ</span> ุฅุถุงูุฉ ุฅุฏุฎุงู ุฌุฏูุฏ
    </a>
</div>

<!-- Statistics Cards -->
<div class="grid grid-3 mb-3">
    <div class="card">
        <div class="card-body">
            <h5 class="text-secondary mb-2" style="font-size: 0.95rem; font-weight: 600;">ุฅุฌูุงูู ุงูุฅุฏุฎุงูุงุช</h5>
            <p class="price" style="font-size: 2rem; margin: 0;">{{ total_entries }}</p>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin: 0.5rem 0 0 0;">{{ filter_label }}</p>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <h5 class="text-secondary mb-2" style="font-size: 0.95rem; font-weight: 600;">ุฅุฌูุงูู ุงููููุฉ</h5>
            <p class="price" style="font-size: 2rem; margin: 0;">{{ total_quantity }}</p>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin: 0.5rem 0 0 0;">ูุญุฏุฉ</p>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <h5 class="text-secondary mb-2" style="font-size: 0.95rem; font-weight: 600;">ุฅุฌูุงูู ุงูุฅููุงู</h5>
            <p class="price" style="font-size: 2rem; margin: 0;">{{ total_spent|floatformat:2 }}</p>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin: 0.5rem 0 0 0;">ุฌููู</p>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="card mb-3">
    <div class="card-header">
        <h3 class="card-title" style="font-size: 1.25rem;">๐ ุชุตููุฉ ูุจุญุซ</h3>
    </div>
    <form method="get" action="{% url 'store:product_entry_list' %}">
        <div class="grid grid-2 mb-3">
            <div class="form-group">
                <label for="search">ุงูุจุญุซ ุจุงูููุชุฌ:</label>
                <input type="text" id="search" name="search" class="form-control" placeholder="ุงุจุญุซ ุนู ููุชุฌ..." value="{{ search_query }}">
            </div>
            <div class="form-group">
                <label for="product">ุชุตููุฉ ุจุงูููุชุฌ:</label>
                <select id="product" name="product" class="form-control">
                    <option value="">ุฌููุน ุงูููุชุฌุงุช</option>
                    {% for product in products %}
                    <option value="{{ product.id }}" {% if selected_product == product.id|stringformat:"s" %}selected{% endif %}>
                        {{ product.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="grid grid-3 mb-3">
            <div class="form-group">
                <label for="entry_type">ููุน ุงูุนูููุฉ:</label>
                <select id="entry_type" name="entry_type" class="form-control">
                    <option value="all" {% if entry_type == 'all' %}selected{% endif %}>ุฌููุน ุงูุฃููุงุน</option>
                    <option value="purchase" {% if entry_type == 'purchase' %}selected{% endif %}>ุดุฑุงุก</option>
                    <option value="return" {% if entry_type == 'return' %}selected{% endif %}>ูุฑุชุฌุน</option>
                    <option value="adjustment" {% if entry_type == 'adjustment' %}selected{% endif %}>ุชุนุฏูู</option>
                </select>
            </div>
            <div class="form-group">
                <label for="date">ุชุตููุฉ ุจุงูุชุงุฑูุฎ:</label>
                <select id="date" name="date" class="form-control">
                    <option value="all" {% if date_filter == 'all' %}selected{% endif %}>ูู ุงูุฃููุงุช</option>
                    <option value="today" {% if date_filter == 'today' %}selected{% endif %}>ุงูููู</option>
                    <option value="week" {% if date_filter == 'week' %}selected{% endif %}>ูุฐุง ุงูุฃุณุจูุน</option>
                    <option value="month" {% if date_filter == 'month' %}selected{% endif %}>ูุฐุง ุงูุดูุฑ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="sort">ุชุฑุชูุจ:</label>
                <select id="sort" name="sort" class="form-control">
                    <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>ุงูุฃุญุฏุซ ุฃููุงู</option>
                    <option value="created_at" {% if sort_by == 'created_at' %}selected{% endif %}>ุงูุฃูุฏู ุฃููุงู</option>
                    <option value="product__name" {% if sort_by == 'product__name' %}selected{% endif %}>ุงูููุชุฌ (ุฃ-ู)</option>
                    <option value="-product__name" {% if sort_by == '-product__name' %}selected{% endif %}>ุงูููุชุฌ (ู-ุฃ)</option>
                    <option value="-quantity" {% if sort_by == '-quantity' %}selected{% endif %}>ุงููููุฉ (ุงูุฃูุจุฑ)</option>
                    <option value="quantity" {% if sort_by == 'quantity' %}selected{% endif %}>ุงููููุฉ (ุงูุฃุตุบุฑ)</option>
                    <option value="-purchase_price" {% if sort_by == '-purchase_price' %}selected{% endif %}>ุงูุณุนุฑ (ุงูุฃุนูู)</option>
                    <option value="purchase_price" {% if sort_by == 'purchase_price' %}selected{% endif %}>ุงูุณุนุฑ (ุงูุฃูู)</option>
                </select>
            </div>
        </div>

        <div class="grid grid-2 mb-3">
            <div class="form-group">
                <label for="start_date">ูู ุชุงุฑูุฎ:</label>
                <input type="date" id="start_date" name="start_date" class="form-control" value="{{ start_date }}">
            </div>
            <div class="form-group">
                <label for="end_date">ุฅูู ุชุงุฑูุฎ:</label>
                <input type="date" id="end_date" name="end_date" class="form-control" value="{{ end_date }}">
            </div>
        </div>

        <div class="flex gap-2">
            <button type="submit" class="btn btn-success">
                <span>๐</span> ุจุญุซ
            </button>
            <a href="{% url 'store:product_entry_list' %}" class="btn btn-secondary">
                <span>โ</span> ุฅุนุงุฏุฉ ุชุนููู
            </a>
        </div>
    </form>
</div>

<!-- Entries Table -->
{% if entries_with_totals %}
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>ุงูููุชุฌ</th>
                <th>ููุน ุงูุนูููุฉ</th>
                <th>ุงููููุฉ</th>
                <th>ุณุนุฑ ุงูุดุฑุงุก (ูููุญุฏุฉ)</th>
                <th>ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ</th>
                <th>ุงูุชุงุฑูุฎ</th>
                <th>ููุงุญุธุงุช</th>
            </tr>
        </thead>
        <tbody>
            {% for item in entries_with_totals %}
            <tr>
                <td style="font-weight: 600;">{{ item.entry.product.name }}</td>
                <td>
                    {% if item.entry.entry_type == 'purchase' %}
                    <span class="badge badge-completed">ุดุฑุงุก</span>
                    {% elif item.entry.entry_type == 'return' %}
                    <span class="badge badge-processing">ูุฑุชุฌุน</span>
                    {% elif item.entry.entry_type == 'adjustment' %}
                    <span class="badge badge-pending">ุชุนุฏูู</span>
                    {% endif %}
                </td>
                <td style="font-weight: 600; color: var(--info-color);">{{ item.entry.quantity }} ูุญุฏุฉ</td>
                <td class="price" style="font-size: 1rem;">{{ item.entry.purchase_price|floatformat:2 }} ุฌููู</td>
                <td class="price">{{ item.total_cost|floatformat:2 }} ุฌููู</td>
                <td style="color: var(--text-secondary); font-size: 0.875rem;">
                    {{ item.entry.created_at|date:"Y-m-d" }}<br>
                    <small>{{ item.entry.created_at|date:"H:i" }}</small>
                </td>
                <td style="color: var(--text-secondary); font-size: 0.875rem;">
                    {{ item.entry.notes|default:"โ" }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="card">
    <div class="empty-state">
        <div class="empty-state-icon">๐ฅ</div>
        <h3>ูุง ุชูุฌุฏ ุฅุฏุฎุงูุงุช</h3>
        <p>ูู ูุชู ุงูุนุซูุฑ ุนูู ุฅุฏุฎุงูุงุช ููุชุฌุงุช ุจุงููุนุงููุฑ ุงููุญุฏุฏุฉ</p>
        <a href="{% url 'store:add_product_entry' %}" class="btn btn-success">
            <span>โ</span> ุฅุถุงูุฉ ุฅุฏุฎุงู ุฌุฏูุฏ
        </a>
    </div>
</div>
{% endif %}

{% endblock %}
